<header>
  <div class="logo">
    <a href="index.html" aria-label="回首頁">
      <img src="images/logo.png" alt="ZJ影像 Logo">
    </a>
  </div>

  <nav aria-label="主選單">
    <button
      class="menu-toggle"
      id="menu-toggle"
      aria-label="開啟選單"
      aria-controls="menu"
      aria-expanded="false">
      <span></span><span></span><span></span>
    </button>

    <ul id="menu" role="menu">
      <li role="none"><a role="menuitem" href="index.html">首頁</a></li>
      <li role="none"><a role="menuitem" href="photo-flat.html">平面攝影</a></li>
      <li role="none"><a role="menuitem" href="photo-event.html">動態攝影</a></li>
      <li role="none"><a role="menuitem" href="photo-short.html">短影音</a></li>
      <li role="none"><a role="menuitem" href="design-web.html">網頁設計</a></li>
      <li role="none"><a role="menuitem" href="design-graphic.html">平面設計</a></li>
      <li role="none"><a role="menuitem" href="marketing.html">廣告行銷</a></li>
      <li role="none"><a role="menuitem" href="price.html">價目表</a></li>
      <li role="none"><a role="menuitem" href="contact.html">聯絡我們</a></li>
    </ul>
  </nav>
</header>

<!-- 半透明背景遮罩 -->
<div id="overlay" aria-hidden="true"></div>

<!-- JS 控制 -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const menuToggle = document.getElementById('menu-toggle');
  const menu = document.getElementById('menu');
  const overlay = document.getElementById('overlay');
  const BREAKPOINT = 768;

  function openMenu(){
    menu.classList.add('open');
    overlay.classList.add('show');
    document.body.classList.add('menu-open');
    menuToggle.setAttribute('aria-expanded','true');
    menuToggle.setAttribute('aria-label','關閉選單');
    trapFocus(menu);
  }
  function closeMenu(){
    menu.classList.remove('open');
    overlay.classList.remove('show');
    document.body.classList.remove('menu-open');
    menuToggle.setAttribute('aria-expanded','false');
    menuToggle.setAttribute('aria-label','開啟選單');
    releaseFocus();
    menuToggle.focus();
  }
  function toggleMenu(){
    menu.classList.contains('open') ? closeMenu() : openMenu();
  }

  menuToggle.addEventListener('click', toggleMenu);
  overlay.addEventListener('click', closeMenu);
  menu.addEventListener('click', e=>{
    if(e.target.closest('a') && window.innerWidth <= BREAKPOINT) closeMenu();
  });
  document.addEventListener('keydown', e=>{
    if(e.key==='Escape' && menu.classList.contains('open')) closeMenu();
  });
  window.addEventListener('resize', ()=>{
    if(window.innerWidth > BREAKPOINT && menu.classList.contains('open')) closeMenu();
  });
  overlay.addEventListener('touchmove', e=> e.preventDefault(), { passive:false });

  // 無障礙焦點圈定
  let focusableEls=[], firstFocusable=null, lastFocusable=null;
  function trapFocus(container){
    focusableEls = Array.from(container.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])'))
      .filter(el=>!el.hasAttribute('disabled')&&!el.getAttribute('aria-hidden'));
    if(!focusableEls.length) return;
    firstFocusable = focusableEls[0];
    lastFocusable = focusableEls[focusableEls.length-1];
    firstFocusable.focus();
    container.addEventListener('keydown', handleTabLoop);
  }
  function releaseFocus(){
    menu.removeEventListener('keydown', handleTabLoop);
    focusableEls=[]; firstFocusable=null; lastFocusable=null;
  }
  function handleTabLoop(e){
    if(e.key!=='Tab') return;
    if(e.shiftKey && document.activeElement===firstFocusable){
      e.preventDefault(); lastFocusable.focus();
    } else if(!e.shiftKey && document.activeElement===lastFocusable){
      e.preventDefault(); firstFocusable.focus();
    }
  }
});
</script>